<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo List App</title>
  </head>
  <body>
    <div id="root"></div>

    <script type="module">
      import yong from '../yong.js';

      // Prop-drilling
      /*
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€ App â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚           â”‚            â”‚
          Header       Todo        Footer
                        â”‚
                    â”Œâ”€â”€â”€â”´â”€â”€â”€â”
              TodoInput   TodoList
                            â”‚
                          TodoItem
      */

      // í—¤ë” êµ¬ì„±
      function Header() {
        return (
          yong.createElement('header', null,
          yong.createElement('h1', null, 'Todo List - ì»´í¬ë„ŒíŠ¸ :)'),
          yong.createElement('p', null, 'íŒŒì¼ ê²½ë¡œ: ',
            yong.createElement('span', { id: 'filepath' }, `ch${document.URL.split('/ch')[1]}index.html`)))
        )
      }

      // ì…ë ¥ì°½ êµ¬ì„±
      function TodoInput({handleAdd, handleAddKeyup}) {
        return (yong.createElement('div', { class: 'todoinput' },
            yong.createElement('input', { type: 'text', autofocus: '', onkeyup: event => handleAddKeyup(event)}),
            yong.createElement('button', { type: 'button', onclick: handleAdd }, 'ì¶”ê°€'))
        )
      }

      // í•  ì¼ ì•„ì´í…œ í•˜ë‚˜ êµ¬ì„±
      function TodoItem({item, toggleDone, deleteItem}) {
        // ë³€ìˆ˜ë¡œ ë”°ë¡œ í• ë‹¹í•´ì¤„ í•„ìš” ì—†ì´, props.itemìì²´ë¥¼ {item}ìœ¼ë¡œ ë°”ë¡œ ë°›ì•„ì™€, êµ³ì´
        // ë°‘ì— ì½”ë“œë“¤ì—ì„œ ì¼ì¼ì´ ëª¨ë“  item -> props.itemì´ë¼ê³  ê³ ì¹  í•„ìš” ì—†ë‹¤.
        // const item = props.item;
        return (
        yong.createElement('li', { 'data-no': item.no },
          yong.createElement('span', null, item.no),
          yong.createElement('span', { onclick: () => toggleDone(item.no) },
            item.done? yong.createElement('s', null, item.title) : item.title),
          yong.createElement('button', { onclick: () => deleteItem(item.no) }, 'ì‚­ì œ'))
        )
      }

      // í•  ì¼ ëª©ë¡ êµ¬ì„±
      function TodoList(props) {
        // App ì»´í¬ë„ŒíŠ¸ë¡œë¶€í„° itemListë¥¼ ë°›ì•„ì˜¤ê¸° ìœ„í•´ propsë¼ëŠ” ë§¤ê°œë³€ìˆ˜ ìƒì„±.
        const list = props.itemList.map((item) => TodoItem({item, toggleDone: props.toggleDone, deleteItem: props.deleteItem}));
        return yong.createElement('ul', { class: 'todolist' }, list)
      }

      // í•  ì¼ êµ¬ì„±
      function Todo(props) {
        return(yong.createElement('div', { id: 'main' },
            yong.createElement('div', { id: 'container' },
            yong.createElement('ul', null,
            yong.createElement('li', null,
            yong.createElement('h2', null, 'ì‡¼í•‘ ëª©ë¡'),
            TodoInput({handleAdd: props.handleAdd, handleAddKeyup: props.handleAddKeyup}),
            TodoList({itemList: props.itemList, toggleDone: props.toggleDone, deleteItem: props.deleteItem})))))
        )
      }

      // í‘¸í„° êµ¬ì„±
      function Footer() {
        return (yong.createElement('footer', null,
            yong.createElement('p', null, 'ë©‹ìŸì´ ì‚¬ìì²˜ëŸ¼ FrontEnd BootCamp')
          ))
      }

      // Application ë£¨íŠ¸ ì»´í¬ë„ŒíŠ¸
      function App(){
        // ìƒ˜í”Œ ëª©ë¡
        // let itemList = [
        //   { no: 1, title: 'ë‘ë¶€', done: true} ,
        //   { no: 2, title: 'ê³„ë€', done: false },
        //   { no: 3, title: 'ë¼ë©´', done: true },
        // ];

        const [itemList, setItemList] = yong.useState([
        { no: 1, title: 'ë‘ë¶€', done: true} ,
        { no: 2, title: 'ê³„ë€', done: false },
        { no: 3, title: 'ë¼ë©´', done: true },
        ]);

        // "ì¶”ê°€" í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (í‘œí˜„ì‹ - í˜¸ì´ìŠ¤íŒ… ë¶ˆê°€ - Todo ë³€ìˆ˜ ë‚´ë¶€ì—ì„œ ì“°ì´ê¸° ë•Œë¬¸ì— ê·¸ ì „ì— ì¨ì¤€ë‹¤.)
        const handleAdd = () => {
          const inputElem = document.querySelector('.todoinput > input');
          if(inputElem.value.trim() !== ''){
            addItem(inputElem.value);
            inputElem.value = '';
            inputElem.focus();
          }
        };

        // ì—”í„° ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ (í‘œí˜„ì‹ - í˜¸ì´ìŠ¤íŒ… ë¶ˆê°€ - ë§ˆì°¬ê°€ì§€ì˜ ì´ìœ ë¡œ ë§¨ ìœ„ì— ì¨ì£¼ì–´ì•¼ í•œë‹¤.)
        const handleAddKeyup = (event) => {
          if(event.key === 'Enter') handleAdd();
        };

      // í• ì¼ ì¶”ê°€
      function addItem(title){
      const item = {
        no: itemList[itemList.length-1].no + 1,
        title,
        done: false,
      };

        // TODO: ë°ì´í„° ê°±ì‹ 
        // ğŸ§©ê°’ì€ ë˜‘ê°™ì§€ë§Œ ì£¼ì†Œê°€ ë‹¤ë¥´ë„ë¡ ...ì„ ì´ìš©í•´ì„œ ìƒˆë¡œìš´ ë°°ì—´ ë§Œë“¤ì!
        // (Primitive data type =/= Reference data type)
        const newItemList = [...itemList, item];
        // newItemList.push(item);
        setItemList(newItemList);
      }

      // ì™„ë£Œ/ë¯¸ì™„ë£Œ ì²˜ë¦¬
      function toggleDone(no){
        // TODO: ë°ì´í„° ê°±ì‹ 
        const newItemList = [...itemList];
        // ğŸ§©
        let selectedItem = newItemList.find(item => item.no === no);
        selectedItem.done = !selectedItem.done;

        setItemList(newItemList);
      }

      // í• ì¼ ì‚­ì œ
      // ë‘ ê°’(oldValue, newValue)ì´ ê°™ì€ì§€ ë¹„êµí•´ì„œ ê°™ì§€ ì•Šì„ ê²½ìš°ì— ë¦¬ë Œë”ë§í•œë‹¤.
      // ê°ì²´ì¼ ë•Œ, ê°™ì€ ë©”ëª¨ë¦¬ ì£¼ì†Œë¥¼ ê°€ì§€ê³  ìˆìœ¼ë©´ true.
      // ë‘ ê°’ì´ ëª¨ë‘ undefinedì´ê±°ë‚˜ Nullì´ë©´ true.
      // ë‘ ê°’ì´ ëª¨ë‘ Trueì´ê±°ë‚˜ falseì´ë©´ true.
      // stringì¼ ê²½ìš°, ë‘ ê°’ì˜ ê¸€ììˆ˜, ìˆœì„œ, ëª¨ë“  ê¸€ìê°€ ê°™ìœ¼ë©´ true
      // Numberë¼ë©´, ê°™ì€ ê°’ì„ ê°€ì§€ê³  ìˆê±°ë‚˜ ë‘˜ ë‹¤ NaNì´ë©´ true
      function deleteItem(no){
        // TODO: ë°ì´í„° ê°±ì‹ 
        // ğŸ§© filter : ìì²´ê°€ ìƒˆë¡œìš´ ë°°ì—´ ë¦¬í„´í•˜ê¸° ë–„ë¬¸ì— êµ³ì´ ...ì¨ì„œ ìƒˆë¡œìš´ ë°°ì—´ ë§Œë“¤ì–´ì„œ í•´ì¤„ í•„ìš” ì—†ë‹¤!!
        // const newItemList = itemList.filter(item => item.no !== no);

        // ğŸ§© splice : ì›ë³¸ ë°ì´í„°ë¥¼ mutationì‹œí‚¤ê³ , mutation í›„ì˜ ì›ë³¸ë°ì´í„°ë¥¼ ë°˜í™˜ ... itemList(ì›ë³¸ë°ì´í„°)ë¥¼ ìœ ì§€í•´ì•¼ í•˜ê¸° ë•Œë¬¸ì— newItemListë¼ëŠ” ìƒˆë¡œìš´ ë°°ì—´ì„ ë§Œë“¤ì–´ ìƒˆë¡­ê²Œ ë°˜í™˜í• (ì‚­ì œë™ì‘ í›„ì— ë¦¬ìŠ¤íŠ¸í•˜ë‚˜ë¥¼ ì—†ì•¨ ê²ƒì´ê¸° ë•Œë¬¸ì— ë°°ì—´ì´ ë°”ë€” ê²ƒ..) ì–´ë ˆì´ë¥¼ setItemList()ë¡œ í™”ë©´ì— ì¶œë ¥!
        const newItemList = [...itemList];
        newItemList.splice(itemList.findIndex((item) => item.no === no), 1)
        setItemList(newItemList);

        // ğŸš¨ ë§Œì•½, ...ë¡œ itemLisë¥¼ ë³µì œí•´ ìƒˆë¡œìš´ ë°°ì—´ì„ ë§Œë“¤ì§€ ì•Šê³ , ê·¸ëƒ¥ spliceë¡œ ê¸°ì¡´ ë°ì´í„°ë¥¼ ë³€í˜•ì‹œí‚¨ë‹¤ìŒì— ê·¸ ë°°ì—´ì„ setItemListë¡œ ì¶œë ¥ì‹œì¼œë„ ëœë‹¤ê³  ìƒê°í–ˆì„ ìˆ˜ ìˆì§€ë§Œ, ê·¸ë ‡ê²Œí•˜ë©´ ë°ì´í„° ê°±ì‹ ì€ ì¼ì–´ë‚¬ì§€ë§Œ, í™”ë©´ê°±ì‹ ì€ ì¼ì–´ë‚˜ì§€ ì•Šê²Œ ëœë‹¤... ì™œëƒ! ë¦¬ë Œë”ë§ë˜ëŠ” ì¡°ê±´ì´ ì• ì´ˆì— ê¸°ì¡´ ë°ì´í„°(oldValue)ì™€ ìƒˆë¡œìš´ ë°ì´í„°(newValue)ê°€ ë™ì¼í•˜ì§€ ì•Šì„ ë•Œ ì¼ì–´ë‚˜ëŠ” ê²ƒì´ê¸° ë•Œë¬¸!
      }

        return yong.createElement('div', { id: 'todo' }, Header, Todo({handleAdd, handleAddKeyup, itemList, toggleDone, deleteItem}), Footer);
      }

      yong.createRoot(document.getElementById('root')).render(App);
    </script>
  </body>
</html>
