<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Todo List App</title>
    <script
      src="https://code.jquery.com/jquery-3.7.1.min.js"
      integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo="
      crossorigin="anonymous"
    ></script>
  </head>
  <body>
    <div id="todo">
      <header>
        <h1>Todo List - jQuery :)</h1>
        <p>íŒŒì¼ ê²½ë¡œ: <span id="filepath"></span></p>
      </header>
      <div id="main">
        <div id="container">
          <ul>
            <li>
              <h2>ì‡¼í•‘ ëª©ë¡</h2>
              <div class="todoinput">
                <input type="text" autofocus onkeyup="handleAddKeyup(event)" />
                <button type="button" onclick="handleAdd()">ì¶”ê°€</button>
              </div>
              <ul class="todolist">
                <li>
                  <span>1</span>
                  <span><s>ìƒ˜í”Œ1</s></span>
                  <button type="button">ì‚­ì œ</button>
                </li>
                <li>
                  <span>2</span>
                  <span>ìƒ˜í”Œ2</span>
                  <button type="button">ì‚­ì œ</button>
                </li>
                <li>
                  <span>3</span>
                  <span>ìƒ˜í”Œ3</span>
                  <button type="button">ì‚­ì œ</button>
                </li>
              </ul>
            </li>
          </ul>
        </div>
      </div>
      <footer>
        <p>ë©‹ìŸì´ ì‚¬ìì²˜ëŸ¼ FrontEnd BootCamp</p>
      </footer>
    </div>

    <script type="text/javascript">
      // http://localhost:5500/workspace-ins/ch01-buildup/todolist/sample/
      // ['http://localhost:5500/workspace-ins/', '/ch01-buildup/todolist/sample/']
      document.querySelector('#filepath').textContent = `ch${document.URL.split('/ch')[1]}index.html`;

      // ìƒ˜í”Œ ëª©ë¡
      let itemList = [
        { no: 1, title: 'ë‘ë¶€', done: true} ,
        { no: 2, title: 'ê³„ë€', done: false },
        { no: 3, title: 'ë¼ë©´', done: true },
      ];

      // ğŸ“Œ ul ìš”ì†Œ ì•ˆì— ìˆëŠ” ëª¨ë“  ìì‹ ìš”ì†Œë¥¼ ì‚­ì œí•´ë¼.
      $('.todolist').children().remove();

      // ê¸°ì¡´ ëª©ë¡ ì‚­ì œ
      // while(todolistElem.firstChild){
      //   todolistElem.firstChild.remove();
      // }

      // itemList ë°°ì—´ì˜ ê° Todo ì•„ì´í…œì„ í™”ë©´ì— ì¶”ê°€
      itemList.forEach((item, index) =>
        getTodoItemElem(item).appendTo('.todolist')
      );

      // í•œê±´ì˜ Todo ê°ì²´ë¥¼ ë°›ì•„ì„œ DOM ê°ì²´ë¡œ ë§Œë“¤ì–´ ë°˜í™˜
      function getTodoItemElem(item){
        return $(`
          <li data-no="${item.no}">
            <span>${item.no}</span>
            <span onclick="toggleDone(${item.no})">${item.done ? `<s>${item.title}</s>` : item.title }</span>
            <button type="button" onclick="deleteItem(${item.no})">ì‚­ì œ</button>
          </li>
        `);
      }

      // "ì¶”ê°€" í´ë¦­ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
      const handleAdd = () => {
        const inputElem = $('.todoinput > input');
        if(inputElem.val().trim() !== ''){
          addItem(inputElem.val());
          inputElem.val('').focus();
        }
      };

      // ì—”í„° ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬
      const handleAddKeyup = (event) => {
        if(event.key === 'Enter') handleAdd();
      };

      // í• ì¼ ì¶”ê°€
      function addItem(title){
        const item = {
          no: itemList[itemList.length-1].no + 1,
          title,
          done: false,
        };

        // TODO: ë°ì´í„° ê°±ì‹ 
        itemList.push(item);

        // TODO: í™”ë©´ ê°±ì‹ 
        getTodoItemElem(item).appendTo('.todolist');
      }

      // ì™„ë£Œ/ë¯¸ì™„ë£Œ ì²˜ë¦¬
      function toggleDone(no){
        // let selectedItem;
        // itemList.forEach(item => {
        //   if(item.no === no){
        //     selectedItem = item;
        //   }
        // });

        // TODO: ë°ì´í„° ê°±ì‹ 
        let selectedItem = itemList.find(item => item.no === no);
        selectedItem.done = !selectedItem.done;

        // TODO: í™”ë©´ ê°±ì‹ 
        const selectedLiElem = $(`.todolist > li[data-no="${ no }"]`);
        selectedLiElem.children('span:last').empty().append(selectedItem.done ? `<s>${selectedItem.title}</s>` : selectedItem.title)
        // <li>
        //   <span>2</span>
        //   <span>ìƒ˜í”Œ2</span>
        //   <button type="button">ì‚­ì œ</button>
        // </li>
      }

      // í• ì¼ ì‚­ì œ
      function deleteItem(no){
        // TODO: ë°ì´í„° ê°±ì‹ 
        itemList = itemList.filter(item => item.no !== no);

        // TODO: í™”ë©´ ê°±ì‹ 
       $(`.todolist > li[data-no="${ no }"]`).remove();
      }
    </script>
  </body>
</html>
